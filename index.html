<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Grower Management</title>
  <style>
   body {
  font-family: Arial, sans-serif;
  margin: 20px;
  background: #f4f6f8;
  line-height: 1.6;
}

h1 {
  color: #333;
  text-align: center;
  margin-bottom: 20px;
}

form {
  margin-bottom: 20px;
  padding: 20px;
  background: #fff;
  border-radius: 10px;
  box-shadow: 0 2px 8px rgba(0,0,0,.1);
  transition: transform 0.2s ease-in-out;
}
form:hover {
  transform: translateY(-2px);
}

label {
  display: block;
  margin-top: 10px;
  font-weight: bold;
  color: #444;
}

input, button {
  padding: 10px;
  margin-top: 5px;
  width: 100%;
  border-radius: 6px;
  border: 1px solid #ccc;
  font-size: 14px;
}

button {
  background: #007bff;
  color: #fff;
  border: none;
  cursor: pointer;
  margin-top: 10px;
  transition: background 0.3s, transform 0.2s;
}
button:hover {
  background: #0056b3;
  transform: scale(1.05);
}

table {
  border-collapse: collapse;
  width: 100%;
  background: #fff;
  margin-top: 20px;
  box-shadow: 0 2px 8px rgba(0,0,0,.1);
  font-size: 14px;
  border-radius: 8px;
  overflow: hidden;
}

th, td {
  padding: 12px;
  border: 1px solid #ddd;
  text-align: left;
  white-space: nowrap;
}

th {
  background: #007bff;
  color: #fff;
  position: sticky;
  top: 0;
}

.actions button {
  margin: 0 3px;
  padding: 6px 12px;
  font-size: 12px;
  border-radius: 4px;
}

.delete-btn {
  background: #e63946;
}
.delete-btn:hover {
  background: #c92a2a;
}

.edit-btn {
  background: #2a9d8f;
}
.edit-btn:hover {
  background: #21867a;
}

.form-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 15px;
}

/* Responsive Design */
@media (max-width: 768px) {
  body {
    margin: 10px;
  }

  form {
    padding: 15px;
  }

  input, button {
    font-size: 13px;
    padding: 8px;
  }

  table {
    font-size: 12px;
    display: block;
    overflow-x: auto; /* Enables horizontal scroll on small screens */
    white-space: nowrap;
  }
  
  th, td {
    padding: 10px;
  }
}

@media (max-width: 480px) {
  h1 {
    font-size: 20px;
  }

  form {
    padding: 12px;
  }

  input, button {
    font-size: 12px;
    padding: 7px;
  }

  .actions button {
    font-size: 10px;
    padding: 5px 8px;
  }
}

  </style>
</head>
<body>
  <h1>Grower Management</h1>

  <!-- Add / Edit Form -->
  <form id="growerForm">
    <h3 id="formTitle">Add Grower</h3>
    <div class="form-grid">
      <label>GR No: <input type="text" id="grNumber" required></label>
      <label>Date: <input type="date" id="date"></label>
      <label>Ref. / Main Party: <input type="text" id="refParty"></label>
      <label>Grower Name: <input type="text" id="gname"></label>
      <label>Phone No: <input type="text" id="pno"></label>
      <label>Address: <input type="text" id="location"></label>
      <label>Challan Name: <input type="text" id="cname"></label>
      <label>Challan No: <input type="text" id="challanNo"></label>
      <label>Khata: <input type="text" id="khata"></label>
      <label>Apple Quantity: <input type="number" id="appleQuantity"></label>
      <label>Driver Name: <input type="text" id="driverName"></label>
      <label>Vehicle No: <input type="text" id="vehicleNumber"></label>
      <label>Driver Contact: <input type="text" id="dcontact"></label>
      <label>Arrival Time/ Date: <input type="text" id="arrivalTime" placeholder="e.g. 10:30 AM / 2025-09-14"></label>
      <label>Variety: <input type="text" id="variety"></label>
      <label>Store Crates: <input type="number" id="storeCrates"></label>
      <label>Self Crates: <input type="number" id="selfCrates"></label>
      <label>Paties: <input type="number" id="paties"></label>
      <label>Total Quantity: <input type="number" id="totalQuality"></label>
    </div>
    <button type="submit">Save</button>
  </form>

  <!-- Grower List -->
  <h2>Grower List</h2>
  <table>
    <thead>
      <tr>
        <th>Timestamp</th>
        <th>GR No.</th>
        <th>Date</th>
        <th>Ref. / Main Party</th>
        <th>Grower Name</th>
        <th>Phone No.</th>
        <th>Address</th>
        <th>Challan Name</th>
        <th>Challan No.</th>
        <th>Khata</th>
        <th>Apple Quantity</th>
        <th>Driver Name</th>
        <th>Vehicle No.</th>
        <th>Driver Contact</th>
        <th>Arrival Time/ Date</th>
        <th>Variety</th>
        <th>Store Crates</th>
        <th>Self Crates</th>
        <th>Paties</th>
        <th>Total Quantity</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="growerTableBody"></tbody>
  </table>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbx22aGaHNVovMdA5y3mTubXAt32G0rxJ5_Ly4sSXkEJqOBF7sKUgLKpzrFmEYiAmekVBA/exec"; // Replace with your GAS web app URL
    let editingGr = null; // Track which grower is being edited

    // Fetch all growers
    async function loadGrowers() {
      const res = await fetch(API_URL);
      const data = await res.json();
      renderTable(data);
    }

    // Render table rows
    function renderTable(rows) {
      const tbody = document.getElementById("growerTableBody");
      tbody.innerHTML = "";
      rows.forEach(row => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${row["Timestamp"] || ""}</td>
          <td>${row["GR No."] || ""}</td>
          <td>${row["Date"] || ""}</td>
          <td>${row["Ref. / Main Party"] || ""}</td>
          <td>${row["Grower Name"] || ""}</td>
          <td>${row["Phone No."] || ""}</td>
          <td>${row["Address"] || ""}</td>
          <td>${row["Challan Name"] || ""}</td>
          <td>${row["Challan No."] || ""}</td>
          <td>${row["Khata"] || ""}</td>
          <td>${row["Apple Quantity"] || ""}</td>
          <td>${row["Driver Name"] || ""}</td>
          <td>${row["Vehicle No."] || ""}</td>
          <td>${row["Driver Contact"] || ""}</td>
          <td>${row["Arival Time/ Date"] || ""}</td>
          <td>${row["Variety"] || ""}</td>
          <td>${row["Store Crates"] || ""}</td>
          <td>${row["Self Crates"] || ""}</td>
          <td>${row["Paties"] || ""}</td>
          <td>${row["Total Quantity"] || ""}</td>
          <td class="actions">
            <button class="edit-btn" onclick="editGrower('${row["GR No."]}')">Edit</button>
            <button class="delete-btn" onclick="deleteGrower('${row["GR No."]}')">Delete</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    // Add / Edit grower
    document.getElementById("growerForm").addEventListener("submit", async function (e) {
      e.preventDefault();
      const body = {
        action: editingGr ? "edit" : "add",
        grNumber: document.getElementById("grNumber").value.trim(),
        date: document.getElementById("date").value,
        refParty: document.getElementById("refParty").value,
        gname: document.getElementById("gname").value,
        pno: document.getElementById("pno").value,
        location: document.getElementById("location").value,
        cname: document.getElementById("cname").value,
        challanNo: document.getElementById("challanNo").value,
        khata: document.getElementById("khata").value,
        appleQuantity: document.getElementById("appleQuantity").value,
        driverName: document.getElementById("driverName").value,
        vehicleNumber: document.getElementById("vehicleNumber").value,
        dcontact: document.getElementById("dcontact").value,
        arrivalTime: document.getElementById("arrivalTime").value,
        variety: document.getElementById("variety").value,
        storeCrates: document.getElementById("storeCrates").value,
        selfCrates: document.getElementById("selfCrates").value,
        paties: document.getElementById("paties").value,
        totalQuality: document.getElementById("totalQuality").value
      };

      const res = await fetch(API_URL, {
        method: "POST",
        body: JSON.stringify(body)
      });
      const result = await res.json();
      alert(result.message);

      if (result.success) {
        this.reset();
        editingGr = null;
        document.getElementById("formTitle").innerText = "Add Grower";
        loadGrowers();
      }
    });

    // Edit grower
    async function editGrower(grNumber) {
      const res = await fetch(API_URL);
      const data = await res.json();
      const grower = data.find(r => r["GR No."] === grNumber);
      if (grower) {
        editingGr = grNumber;
        document.getElementById("formTitle").innerText = "Edit Grower";
        document.getElementById("grNumber").value = grower["GR No."] || "";
        document.getElementById("date").value = grower["Date"] || "";
        document.getElementById("refParty").value = grower["Ref. / Main Party"] || "";
        document.getElementById("gname").value = grower["Grower Name"] || "";
        document.getElementById("pno").value = grower["Phone No."] || "";
        document.getElementById("location").value = grower["Address"] || "";
        document.getElementById("cname").value = grower["Challan Name"] || "";
        document.getElementById("challanNo").value = grower["Challan No."] || "";
        document.getElementById("khata").value = grower["Khata"] || "";
        document.getElementById("appleQuantity").value = grower["Apple Quantity"] || "";
        document.getElementById("driverName").value = grower["Driver Name"] || "";
        document.getElementById("vehicleNumber").value = grower["Vehicle No."] || "";
        document.getElementById("dcontact").value = grower["Driver Contact"] || "";
        document.getElementById("arrivalTime").value = grower["Arival Time/ Date"] || "";
        document.getElementById("variety").value = grower["Variety"] || "";
        document.getElementById("storeCrates").value = grower["Store Crates"] || "";
        document.getElementById("selfCrates").value = grower["Self Crates"] || "";
        document.getElementById("paties").value = grower["Paties"] || "";
        document.getElementById("totalQuality").value = grower["Total Quantity"] || "";
      }
    }

    // Delete grower
    async function deleteGrower(grNumber) {
      if (!confirm("Delete this grower?")) return;
      const res = await fetch(API_URL, {
        method: "POST",
        body: JSON.stringify({ action: "delete", grNumber })
      });
      const result = await res.json();
      alert(result.message);
      if (result.success) loadGrowers();
    }

    // Load growers on page load
    loadGrowers();
  </script>
</body>
</html>
